<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>CSV zu RSS Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      color-scheme: light dark;
      --bg: #0d1117;
      --fg: #c9d1d9;
      --muted: #8b949e;
      --accent: #58a6ff;
      --border: #30363d;
      --card: #161b22;
      --shadow: 0 8px 24px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #161b22, #02040a);
      color: var(--fg);
      display: flex;
      align-items: stretch;
      justify-content: center;
      min-height: 100vh;
    }

    .app {
      max-width: 1200px;
      width: 100%;
      padding: 24px;
      box-sizing: border-box;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.3fr);
      gap: 24px;
    }

    @media (max-width: 900px) {
      .app {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: linear-gradient(135deg, rgba(22,27,34,0.98), rgba(13,17,23,0.98));
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 20px 22px;
    }

    h1, h2 {
      font-weight: 600;
      letter-spacing: 0.02em;
      margin: 0 0 10px;
    }

    h1 {
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    h1 span.emoji {
      font-size: 1.4rem;
    }

    h2 {
      font-size: 1.05rem;
      margin-top: 18px;
    }

    p {
      margin: 4px 0 10px;
      font-size: 0.9rem;
      color: var(--muted);
    }

    label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 4px;
      color: var(--muted);
    }

    input[type="text"],
    input[type="url"],
    select,
    textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #0d1117;
      color: var(--fg);
      font-size: 0.9rem;
      font-family: inherit;
      outline: none;
    }

    textarea {
      min-height: 360px;
      resize: vertical;
      font-family: var(--mono);
      font-size: 0.8rem;
      line-height: 1.4;
      white-space: pre;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(88,166,255,0.3);
    }

    .row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .row-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
    }

    .field {
      margin-bottom: 10px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.7rem;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      margin-left: 6px;
    }

    .badge code {
      font-family: var(--mono);
      font-size: 0.7rem;
    }

    .btn-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    button {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #1f6feb;
      color: white;
      padding: 7px 14px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 4px 10px rgba(31,111,235,0.4);
    }

    button.secondary {
      background: #161b22;
      color: var(--fg);
      box-shadow: none;
    }

    button.small {
      padding: 5px 10px;
      font-size: 0.75rem;
    }

    button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.6);
    }

    .file-input {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 8px;
    }

    .file-input input[type="file"] {
      font-size: 0.8rem;
    }

    .status {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .status strong {
      color: var(--accent);
    }

    .hint {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.76rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #111827;
      border: 1px solid #1f2937;
      color: var(--muted);
    }

    .pill code {
      font-family: var(--mono);
      font-size: 0.75rem;
    }

    .footer {
      margin-top: 6px;
      font-size: 0.75rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .footer span {
      opacity: 0.9;
    }

    .footer code {
      font-family: var(--mono);
      font-size: 0.75rem;
    }

    .pill-group {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .checklist {
      font-size: 0.78rem;
      color: var(--muted);
      margin: 6px 0 0;
      padding-left: 16px;
    }
  </style>
</head>
<body>

<div class="app">
  <!-- Konfiguration -->
  <section class="card">
    <h1>
      <span class="emoji">ðŸ“¡</span>
      CSV zu RSS Generator
      <span class="badge">
        erwartet Header wie
        <code>title,link,description,pubDate</code>
      </span>
    </h1>
    <p>
      Lade eine CSV, wÃ¤hle das Trennzeichen und mappe die Spalten.
      Links kommt deine CSV rein, rechts entsteht RSS XML.
    </p>

    <h2>1. CSV Quelle</h2>
    <div class="field">
      <label for="delimiter">
        Trennzeichen
      </label>
      <div class="row">
        <select id="delimiter">
          <option value="auto">Automatisch erkennen</option>
          <option value=",">Komma ,</option>
          <option value=";">Semikolon ;</option>
          <option value="tab">Tabulator</option>
        </select>
        <div>
          <span class="pill">
            Tipp
            <code>.csv</code> oft Komma oder Semikolon
          </span>
        </div>
      </div>
      <div class="file-input">
        <input type="file" id="csvFile" accept=".csv,text/csv">
        <button type="button" id="btnSample" class="secondary small">Beispiel CSV einfÃ¼gen</button>
      </div>
      <div class="status" id="status">Noch keine CSV geladen.</div>
    </div>

    <h2>2. Channel Metadaten</h2>
    <div class="field">
      <label for="channelTitle">Channel Titel</label>
      <input id="channelTitle" type="text" value="Mein CSV Feed">
    </div>
    <div class="field">
      <label for="channelLink">Channel Link</label>
      <input id="channelLink" type="url" value="https://example.com">
    </div>
    <div class="field">
      <label for="channelDescription">Channel Beschreibung</label>
      <input id="channelDescription" type="text" value="RSS Feed aus CSV generiert.">
    </div>

    <h2>3. Spaltenzuordnung</h2>
    <p class="hint">
      Trage hier die Spaltennamen ein, wie sie in der ersten Zeile deiner CSV stehen.
    </p>

    <div class="row-3">
      <div class="field">
        <label for="colTitle">Titel Spalte</label>
        <input id="colTitle" type="text" value="title">
      </div>
      <div class="field">
        <label for="colLink">Link Spalte</label>
        <input id="colLink" type="text" value="link">
      </div>
      <div class="field">
        <label for="colDescription">Beschreibung Spalte</label>
        <input id="colDescription" type="text" value="description">
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label for="colPubDate">
          Datum Spalte
          <span class="badge"><code>pubDate</code> optional</span>
        </label>
        <input id="colPubDate" type="text" value="pubDate">
        <p class="hint">
          Format kann ISO Datum oder schon fertiges RSS Datum sein.
        </p>
      </div>
      <div class="field">
        <label for="dateFallback">
          Fallback Datum
        </label>
        <select id="dateFallback">
          <option value="today">Heutiges Datum nutzen, wenn Feld leer</option>
          <option value="skip">EintrÃ¤ge ohne Datum Ã¼berspringen</option>
        </select>
      </div>
    </div>

    <h2>4. Steuerung</h2>
    <div class="btn-bar">
      <button type="button" id="btnGenerate">
        ðŸš€ RSS generieren
      </button>
      <button type="button" id="btnCopy" class="secondary">
        ðŸ“‹ In Zwischenablage kopieren
      </button>
      <button type="button" id="btnDownload" class="secondary">
        ðŸ’¾ rss.xml herunterladen
      </button>
    </div>

    <ul class="checklist">
      <li>CSV mit Headerzeile laden.</li>
      <li>Spaltennamen prÃ¼fen.</li>
      <li>Generieren und Feed testen mit einem RSS Reader.</li>
    </ul>

    <div class="footer">
      <span>Ausgabeformat: <code>RSS 2.0</code> mit <code>&lt;item&gt;</code> je Zeile</span>
      <span id="itemCountInfo"></span>
    </div>
  </section>

  <!-- Ausgabe -->
  <section class="card">
    <h2>RSS XML Ausgabe</h2>
    <p>
      Hier erscheint der komplette Feed.
      Du kannst ihn direkt als <code>rss.xml</code> auf deinem Server ablegen.
    </p>
    <textarea id="rssOutput" spellcheck="false"></textarea>
  </section>
</div>

<script>
  // Hilfsfunktionen

  function detectDelimiter(text) {
    const sampleLines = text.split(/\r?\n/).slice(0, 5).filter(Boolean);
    if (!sampleLines.length) return ",";

    const counts = { ",": 0, ";": 0, "tab": 0 };
    sampleLines.forEach(line => {
      counts[","] += (line.match(/,/g) || []).length;
      counts[";"] += (line.match(/;/g) || []).length;
      counts["tab"] += (line.match(/\t/g) || []).length;
    });

    let best = ",";
    let bestCount = -1;
    for (const key of Object.keys(counts)) {
      if (counts[key] > bestCount) {
        bestCount = counts[key];
        best = key;
      }
    }
    if (best === "tab") return "\t";
    return best;
  }

  function parseCSV(text, delimiter) {
    const lines = text.split(/\r?\n/).filter(l => l.trim().length > 0);
    if (lines.length === 0) return { headers: [], rows: [] };

    const delim = delimiter === "auto" ? detectDelimiter(text) : delimiter;
    const headerLine = lines[0];
    const headers = splitLine(headerLine, delim).map(h => h.trim());
    const rows = [];

    for (let i = 1; i < lines.length; i++) {
      const parts = splitLine(lines[i], delim);
      if (parts.every(p => p.trim().length === 0)) continue;
      const row = {};
      headers.forEach((h, idx) => {
        row[h] = (parts[idx] || "").trim();
      });
      rows.push(row);
    }
    return { headers, rows, delimiter: delim };
  }

  // einfache CSV Zeilenlogik mit AnfÃ¼hrungszeichen
  function splitLine(line, delimiter) {
    const result = [];
    let current = "";
    let inQuotes = false;
    const d = delimiter;

    for (let i = 0; i < line.length; i++) {
      const char = line[i];
      const next = line[i + 1];

      if (char === '"' ) {
        if (inQuotes && next === '"') {
          current += '"';
          i++;
        } else {
          inQuotes = !inQuotes;
        }
      } else if (char === d && !inQuotes) {
        result.push(current);
        current = "";
      } else {
        current += char;
      }
    }
    result.push(current);
    return result;
  }

  function escapeXML(str) {
    return String(str || "")
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&apos;");
  }

  function toRssDate(dateString) {
    if (!dateString) return null;

    const d1 = new Date(dateString);
    if (!isNaN(d1.getTime())) {
      return d1.toUTCString();
    }

    const d2 = new Date(dateString.replace(/\./g, "/"));
    if (!isNaN(d2.getTime())) {
      return d2.toUTCString();
    }

    return null;
  }

  function todayRssDate() {
    return new Date().toUTCString();
  }

  // DOM Elemente

  const csvFileInput = document.getElementById("csvFile");
  const delimiterSelect = document.getElementById("delimiter");
  const statusEl = document.getElementById("status");
  const rssOutput = document.getElementById("rssOutput");
  const itemCountInfo = document.getElementById("itemCountInfo");

  const channelTitleInput = document.getElementById("channelTitle");
  const channelLinkInput = document.getElementById("channelLink");
  const channelDescriptionInput = document.getElementById("channelDescription");

  const colTitleInput = document.getElementById("colTitle");
  const colLinkInput = document.getElementById("colLink");
  const colDescriptionInput = document.getElementById("colDescription");
  const colPubDateInput = document.getElementById("colPubDate");
  const dateFallbackSelect = document.getElementById("dateFallback");

  const btnGenerate = document.getElementById("btnGenerate");
  const btnCopy = document.getElementById("btnCopy");
  const btnDownload = document.getElementById("btnDownload");
  const btnSample = document.getElementById("btnSample");

  let currentCSVText = "";
  let parsed = { headers: [], rows: [], delimiter: "," };

  // CSV Laden

  csvFileInput.addEventListener("change", () => {
    const file = csvFileInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
      currentCSVText = e.target.result;
      parsed = parseCSV(currentCSVText, delimiterSelect.value);
      statusEl.innerHTML = `CSV geladen. Erkanntes Trennzeichen: <strong>${parsed.delimiter === "\t" ? "Tab" : parsed.delimiter}</strong>. Spalten: <strong>${parsed.headers.join(", ")}</strong>. Zeilen: <strong>${parsed.rows.length}</strong>.`;
      itemCountInfo.textContent = "";
    };
    reader.readAsText(file, "utf-8");
  });

  delimiterSelect.addEventListener("change", () => {
    if (!currentCSVText) return;
    parsed = parseCSV(currentCSVText, delimiterSelect.value);
    statusEl.innerHTML = `CSV neu geparst. Trennzeichen: <strong>${parsed.delimiter === "\t" ? "Tab" : parsed.delimiter}</strong>. Spalten: <strong>${parsed.headers.join(", ")}</strong>. Zeilen: <strong>${parsed.rows.length}</strong>.`;
    itemCountInfo.textContent = "";
  });

  // Beispiel CSV

  btnSample.addEventListener("click", () => {
    const sample = [
      "title,link,description,pubDate",
      "Erster Eintrag,https://example.com/1,Das ist der erste Testeintrag,2025-11-01",
      "Zweiter Eintrag,https://example.com/2,Noch ein Eintrag mit Text,2025-11-05",
      "Ohne Datum,https://example.com/3,Hier fehlt das Datum,"
    ].join("\n");

    currentCSVText = sample;
    parsed = parseCSV(currentCSVText, ",");
    delimiterSelect.value = ",";
    statusEl.innerHTML = `Beispiel CSV geladen. Spalten: <strong>${parsed.headers.join(", ")}</strong>. Zeilen: <strong>${parsed.rows.length}</strong>.`;
    itemCountInfo.textContent = "";
    rssOutput.value = sample;
  });

  // RSS Generierung

  btnGenerate.addEventListener("click", () => {
    if (!currentCSVText || !parsed.rows.length) {
      alert("Bitte erst eine CSV laden oder das Beispiel nutzen.");
      return;
    }

    const channelTitle = channelTitleInput.value.trim() || "CSV Feed";
    const channelLink = channelLinkInput.value.trim() || "https://example.com";
    const channelDescription = channelDescriptionInput.value.trim() || "RSS Feed aus CSV.";

    const colTitle = colTitleInput.value.trim();
    const colLink = colLinkInput.value.trim();
    const colDescription = colDescriptionInput.value.trim();
    const colPubDate = colPubDateInput.value.trim();
    const fallbackMode = dateFallbackSelect.value;

    const lines = [];
    lines.push('<?xml version="1.0" encoding="UTF-8"?>');
    lines.push('<rss version="2.0">');
    lines.push("  <channel>");
    lines.push(`    <title>${escapeXML(channelTitle)}</title>`);
    lines.push(`    <link>${escapeXML(channelLink)}</link>`);
    lines.push(`    <description>${escapeXML(channelDescription)}</description>`);
    lines.push(`    <lastBuildDate>${todayRssDate()}</lastBuildDate>`);
    lines.push("    <generator>CSV to RSS HTML Tool</generator>");

    let countItems = 0;

    parsed.rows.forEach((row, index) => {
      const title = colTitle ? row[colTitle] : "";
      const link = colLink ? row[colLink] : "";
      const description = colDescription ? row[colDescription] : "";

      let pubDateValue = "";
      if (colPubDate && row[colPubDate]) {
        const rssDate = toRssDate(row[colPubDate]);
        pubDateValue = rssDate || row[colPubDate];
      } else {
        if (fallbackMode === "today") {
          pubDateValue = todayRssDate();
        } else if (fallbackMode === "skip") {
          pubDateValue = null;
        }
      }

      if (!title && !description && !link) {
        return;
      }

      lines.push("    <item>");
      if (title) {
        lines.push(`      <title>${escapeXML(title)}</title>`);
      }
      if (link) {
        lines.push(`      <link>${escapeXML(link)}</link>`);
        lines.push(`      <guid isPermaLink="true">${escapeXML(link)}</guid>`);
      } else {
        lines.push(`      <guid isPermaLink="false">${escapeXML("item-" + index)}</guid>`);
      }
      if (description) {
        lines.push(`      <description>${escapeXML(description)}</description>`);
      }
      if (pubDateValue) {
        lines.push(`      <pubDate>${escapeXML(pubDateValue)}</pubDate>`);
      }
      lines.push("    </item>");
      countItems++;
    });

    lines.push("  </channel>");
    lines.push("</rss>");

    rssOutput.value = lines.join("\n");
    itemCountInfo.textContent = countItems + " Items im Feed.";
  });

  // Copy

  btnCopy.addEventListener("click", async () => {
    const text = rssOutput.value;
    if (!text.trim()) {
      alert("Noch kein RSS Inhalt vorhanden.");
      return;
    }
    try {
      await navigator.clipboard.writeText(text);
      alert("RSS in die Zwischenablage kopiert.");
    } catch (e) {
      alert("Kopieren nicht mÃ¶glich. Markiere den Text und kopiere ihn manuell.");
    }
  });

  // Download

  btnDownload.addEventListener("click", () => {
    const text = rssOutput.value;
    if (!text.trim()) {
      alert("Noch kein RSS Inhalt vorhanden.");
      return;
    }
    const blob = new Blob([text], { type: "application/rss+xml;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "rss.xml";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });
</script>

</body>
</html>
